---
title: SpringBoot(ë°±ì—”ë“œ), React(í”„ë¡ íŠ¸ì—”ë“œ) ì‚¬ì´ CORS ë¬¸ì œ
author: The journey is the reward
date:   2024-11-07 12:07:06 +09:00
categories: [study]
tags: [study]
---


## SpringBoot(ë°±ì—”ë“œ), React(í”„ë¡ íŠ¸ì—”ë“œ) ì‚¬ì´ CORS ë¬¸ì œ

ì„œë²„ëŠ” ìŠ¤í”„ë§ë¶€íŠ¸ì´ê³ , í”„ë¡ íŠ¸ ë‹¨ì€ Reactë¥¼ ì‚¬ìš©í•˜ì˜€ëŠ”ë° ì„œë²„ì— Requestë¥¼ ìš”ì²­í•  ë•Œ CORS ì—ëŸ¬ê°€ ë°œìƒí–ˆë‹¤.

CORSëŠ” ë¬´ì—‡ì¼ê¹Œ?

êµì°¨ ì¶œì²˜ ë¦¬ì†ŒìŠ¤ ê³µìœ ë¥¼ ëœ»í•˜ëŠ” CORSëŠ” **ì„œë¡œ ë‹¤ë¥¸ ì¶œì²˜ì—ì„œ ë¦¬ì†ŒìŠ¤ë¥¼ ê³µìœ **í•˜ëŠ” ê²ƒì„ ëœ»í•œë‹¤.

[corsë€?](https://leenayoung240.github.io/posts/cors/)

ì—¬ê¸°ì„œ `ì¶œì²˜`ë€ ë‹¤ìŒì˜ ì‚¬ì§„ì„ ë³´ì.

<a href="https://github.com/LeeNaYoung240/LeeNaYoung240.github.io/assets/107848521/6d5b69d7-8c1c-4984-835b-be7e5fb9297f" class="popup img-link"><img src="https://github.com/user-attachments/assets/6d5b69d7-8c1c-4984-835b-be7e5fb9297f" alt="1" loading="lazy"></a>

URLì€ **https://www.domain.com:3000/user?query=name&page=1**ì™€ ê°™ì€ í˜•íƒœë¡œ ì´ë£¨ì–´ì ¸ ìˆë‹¤.

ì—¬ê¸°ì„œ `Protocol`, `Host`, `Port`ë¥¼ í•©ì³ì„œ ë¶€ë¥´ëŠ” ë§ì´ `Origin(ì¶œì²˜)`ì´ë‹¤.

CORS í—ˆìš© ì„¤ì •ì„ í•˜ì§€ ì•Šìœ¼ë©´ ì„œë²„ì™€ ë‹¤ë¥¸ Originì„ ê°€ì§„ ê³³ì—ì„œ ì„œë²„ì˜ Originì— ìš”ì²­ì„ ë³´ë‚´ë©´ CORS ì—ëŸ¬ê°€ ë°œìƒí•œë‹¤.

í”„ë¡œì íŠ¸ë¥¼ í•˜ë©°  CORS ì—ëŸ¬ê°€ ë°œìƒí–ˆë‹¤.

<a href="https://github.com/LeeNaYoung240/LeeNaYoung240.github.io/assets/107848521/3d0a7d14-a86e-4973-845b-129b98f59678" class="popup img-link"><img src="https://github.com/user-attachments/assets/3d0a7d14-a86e-4973-845b-129b98f59678" alt="1" loading="lazy"></a>

```bash
Access to fetch at 'http://localhost:8080/api/users/login' from origin 'http://localhost:3000' has been blocked by CORS policy: Response to preflight request doesn't pass access control check: No 'Access-Control-Allow-Origin' header is present on the requested resource. If an opaque response serves your needs, set the request's mode to 'no-cors' to fetch the resource with CORS disabled.
```

```java
@Configuration  
public class WebSecurityConfig implements WebMvcConfigurer {  
  
    @Override  
  public void addCorsMappings(CorsRegistry registry) {  
        registry  
                .addMapping("/**")  
                .allowedOrigins("http://localhost:3000")  
                .allowedMethods("GET", "POST", "PUT", "PATCH", "DELETE", "OPTIONS")  
               
  }  
  
}
```

ë³´í†µì€ ë‹¤ìŒê³¼ ê°™ì´ **addCorsMappings** ë©”ì„œë“œë¥¼ ì˜¤ë²„ë¼ì´ë”©í•˜ì—¬ ëª¨ë“  **RequestMapping**ì— ëŒ€í•˜ì—¬ í†µì‹ ì„ ì£¼ê³  ë°›ëŠ” React Originì˜ ìš”ì²­ì— ëŒ€í•´ CORSë¥¼ í—ˆìš©í•˜ë©´ ëì—ˆë‹¤.


í•˜ì§€ë§Œ ì´ëŸ° ë°©ë²•ìœ¼ë¡œëŠ” í•´ê²°ë˜ì§€ ì•Šì•˜ë‹¤..ğŸ˜‚

`SecurityConfig` íŒŒì¼ì—ì„œ ë‹¤ìŒì„ ì¶”ê°€í•´ ì£¼ë©´ ëœë‹¤.

```java
@Bean
public CorsConfigurationSource corsConfigurationSource() {
    CorsConfiguration configuration = new CorsConfiguration();
    configuration.addAllowedOrigin("http://localhost:3000"); // í—ˆìš©í•  í”„ë¡ íŠ¸ì—”ë“œ ë„ë©”ì¸
    configuration.addAllowedMethod("*"); // ëª¨ë“  HTTP ë©”ì„œë“œ í—ˆìš©
    configuration.addAllowedHeader("*"); // ëª¨ë“  í—¤ë” í—ˆìš©
    configuration.setAllowCredentials(true); // ì¸ì¦ ì •ë³´ë¥¼ í¬í•¨í•œ ìš”ì²­ í—ˆìš©

    UrlBasedCorsConfigurationSource source = new UrlBasedCorsConfigurationSource();
    source.registerCorsConfiguration("/**", configuration); // ëª¨ë“  ê²½ë¡œì— ëŒ€í•´ ì„¤ì • ì ìš©

    return source;
}
```

-   `addAllowedOrigin("http://localhost:3000")`: `localhost:3000`ì—ì„œ ì˜¨ ìš”ì²­ë§Œ í—ˆìš©.
-   `addAllowedMethod("*")`: ëª¨ë“  HTTP ë©”ì„œë“œ (GET, POST ë“±)ë¥¼ í—ˆìš©.
-   `addAllowedHeader("*")`: ëª¨ë“  í—¤ë”ë¥¼ í—ˆìš©.
-   `setAllowCredentials(true)`: ì¸ì¦ ì •ë³´(ì˜ˆ: ì¿ í‚¤)ë¥¼ í¬í•¨í•œ ìš”ì²­ì„ í—ˆìš©.

ê·¸ í›„ì— CORS ì„¤ì •ì„ `httpSecurity`ì— ì ìš©í•œë‹¤.

```java
httpSecurity.cors((cors) -> cors.configurationSource(corsConfigurationSource()));
```

ì´ë¡œ ì¸í•´ `httpSecurity`ëŠ” í´ë¼ì´ì–¸íŠ¸ì—ì„œ ì˜¤ëŠ” ìš”ì²­ì— ëŒ€í•´ CORS ì •ì±…ì„ ì²´í¬í•˜ê³  ì²˜ë¦¬í•œë‹¤!

<a href="https://github.com/LeeNaYoung240/LeeNaYoung240.github.io/assets/107848521/53e76c02-3300-493d-a782-5f199e62c338" class="popup img-link"><img src="https://github.com/user-attachments/assets/53e76c02-3300-493d-a782-5f199e62c338" alt="1" loading="lazy"></a>

ë‹¤ìŒê³¼ ê°™ì´ `Network` > `Response Headers`ì— ì˜ ë‹´ê¸´ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.


```java
@Bean  
public SecurityFilterChain securityFilterChain(HttpSecurity httpSecurity) throws Exception {  
    httpSecurity.csrf((csrf) -> csrf.disable());  
  
    httpSecurity.sessionManagement((sessionManagement) ->  
            sessionManagement.sessionCreationPolicy(SessionCreationPolicy.STATELESS)  
    );  
  
    httpSecurity.authorizeHttpRequests((authorizeRequest) ->  
            authorizeRequest  
                    .requestMatchers("/api/users/login").permitAll()  
                    .anyRequest().authenticated()  
    ).cors((cors) -> cors.configurationSource(corsConfigurationSource()));  
  
    httpSecurity.addFilterBefore(jwtAuthenticationFilter(), UsernamePasswordAuthenticationFilter.class);  
    httpSecurity.addFilterAfter(jwtAuthorizationFilter(), JwtAuthenticationFilter.class);  
  
    return httpSecurity.build();  
}
```

ê³„ì† httpSecurity.cors()ë¡œ í•´ì„œ ì˜¤ë¥˜ê°€ ë‚¬ì—ˆë‹¤..ğŸ˜“